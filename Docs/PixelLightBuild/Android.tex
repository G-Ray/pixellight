\chapter{Android}
In principle, there's no difference in building PixelLight for Android on a MS Windows or Linux host. So, the following description is e.g. not MS Windows only.

Warning: We noticed several issues when using the Android NDK under MS Windows (tested with \emph{"ndk r6b})
\begin{itemize}
\item{The linker eat characters resulting in errors like "CMakeFiles/PLCore.dr/src/File/FileSearchLinux.cpp not found" while the filename was "CMakeFiles/PLCore.dir/src/File/FileSearchLinux.cpp"}
\item{Performance issues, the build process is slow, really slow}
\end{itemize}




\section{Prerequisites}
\begin{itemize}
\item{PixelLight requires at least Android 2.3 (Gingerbread, NDK API level 9), previous Android versions had no decent native support}
\item{In case you want to use OpenGL ES 2.0, you'll need a physical device because currently the Android Emulator has no support for OpenGL ES 2.0}
\end{itemize}

Install the usual Android development tools (the following versions are those used when writing this, other versions may work as well)


\paragraph{Java JDK and JRE}
Required for the Android build, not for PixelLight itself.


\paragraph{Android SDK (\emph{r12})}
\begin{itemize}
\item{Android SDK Tools, revision 12}
\item{Android SDK Platform-tools, revision 6}
\item{SDK Platform Android 2.2, API 9, revision 3}
\end{itemize}


\paragraph{Android NDK (\emph{ndk r6b}) - Linux}
This example assumes that the data has been extracted directly within the home (\emph{\textasciitilde}) directory: Open hidden \emph{\textasciitilde /.bashrc} and add:
\begin{lstlisting}[language=sh]
# Important Android SDK and NDK paths
export ANDROID_SDK=~/android-sdk-linux_x86
export ANDROID_NDK=~/android-ndk-r6b
export PATH=${PATH}:${ANDROID_SDK}/tools:${ANDROID_SDK}/platform-tools:~/${ANDROID_NDK}
\end{lstlisting}


\paragraph{Android NDK (\emph{ndk r6b}) - MS Windows}
\begin{itemize}
\item{Extract it and set the MS Windows PATH environment variable \emph{ANDROID\_NDK} to the NDK root directory}
\item{Set the MS Windows \emph{PATH} environment variable \emph{ANDROID\_NDK\_TOOLCHAIN\_ROOT} to the NDK toolchain root directory (e.g. "C:/android-ndk-r6b/toolchains/arm-linux-androideabi-4.4.3/prebuilt/windows/arm-linux-androideabi")}
\item{(Those variables can also be added/set within the CMake-GUI)}
\end{itemize}


\paragraph{make (Windows)}
\begin{itemize}
\item{\emph{Make for Windows}: Make: GNU make utility to maintain groups of programs}
\item{Directly used by the CMake scripts under MS Windows when using the Android NDK toolchain}
\item{\emph{cmake/UsedTools/make/make.exe} was downloaded from \url{http://gnuwin32.sourceforge.net/packages/make.htm}}
\end{itemize}
This tool can't be set within a CMake file automatically, there are several options:
\begin{itemize}
\item{Add \emph{\textless PixelLight root path\textgreater /cmake/UsedTools/make} to the MS Windows \emph{PATH} environment variable *recommended*}
\item{Use a MinGW installer from e.g. \url{http://www.tdragon.net/recentgcc/} which can set the \emph{PATH} environment variable *overkill because only the 171 KiB \emph{make} is required*}
\item{Use CMake from inside a command prompt by typing for example (\emph{DCMAKE\_TOOLCHAIN\_FILE} is only required when using a toolchain) *not really comfortable when working with it on a regular basis*
\begin{quotation}
cmake.exe -G"Unix Makefiles" -DCMAKE\_MAKE\_PROGRAM="<PixelLight root path>/cmake/UsedTools/make/make.exe" -DCMAKE\_TOOLCHAIN\_FILE="<PixelLight root path>/cmake/Toolchains7Toolchain-ndk.cmake"
\end{quotation}}
\end{itemize}




\section{Create Makefiles and Build}
Here's how to compile PixelLight by using the CMake-GUI:
\begin{itemize}
\item{Ensure "make" (GNU make utility to maintain groups of programs) can be found by CMake (add for instance "\textless PixelLight root path\textgreater /cmake/UsedTools/make" to the MS Windows \emph{PATH} environment variable)}
\item{Start "CMake (cmake-gui)"}
\item{"Where is the source code"-field: e.g. "C:/PixelLight"}
\item{"Where to build the binaries"-field: e.g. "C:/PixelLight/CMakeOutput"}
\item{In case you want to use the Android Emulator instead of a physical Android device: Click on "Add Entry", add a variable named \emph{ARM\_TARGET} of the type \emph{STRING} and assign the value \emph{armeabi} to it (default is \emph{armeabi-v7a} for a physical Android device)}
\item{Press the "Configure"-button}
\item{Choose the generator "Unix Makefiles" and select the radio box "Specify toolchain file for cross-compiling"}
\item{Press the "Next"-button}
\item{"Specify the Toolchain file": e.g. "C:/PixelLight/cmake/Toolchains/Toolchain-ndk.cmake"}
\item{Press the "Generate"-button}
\item{(The CMake part is done, you can close "CMake (cmake-gui)" now)}
\item{(Ensure you have all required external packages, see chapter~\ref{Chapter:ExternalDependencies})}
\item{Open a command prompt and change into e.g. "C:/PixelLight/CMakeOutput" (MS Windows: by typing "cd /D C:/PixelLight/CMakeOutput" -> "/D" is only required when changing into another partition)}
\item{Type "make" (example: "make -j 4 -k" will use four CPU cores and will keep on going when there are errors)}
\item{(You now should have the ready to be used Android shared library files)}
\end{itemize}
